{% extends "papers/base.html" %}

{% block styles %}

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<style>
    .upload-container {
        max-width: 700px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: var(--secondary-color);
    }

    .upload-title {
        font-size: 2rem;
        font-weight: 500;
        font-family: var(--heading-font);
        text-transform: uppercase;
        text-align: center;
        margin-bottom: 1rem;
        color: var(--heading-text-color);
    }

    .form-field {
        margin-bottom: 1rem;
    }

    .form-field label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--body-text-color);
    }

    .form-field input[type="text"],
    .form-field input[type="number"],
    .form-field input[type="file"] {
        width: 100%;
        padding: 0.75rem;
        background-color: var(--input-color);
        border: none;
        font-family: inherit;
        font-size: 1rem;
    }

    .authors-box {
        overflow-y: auto;
    }

    .authors-box label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .upload-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 2rem;
    }

    .upload-btn {
        background-color: var(--heading-text-color);
        color: var(--primary-color);
        border: none;
        padding: 0.75rem 2rem;
        font-family: inherit;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .upload-container {
            padding: 1.5rem;
        }

        .upload-title {
            font-size: 2rem;
        }
    }

    .select2-container--default .select2-selection--multiple {
        background-color: #e9e5e3;
        border: none;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        background-color: #000;
        color: #fff;
        /* padding: 0.3rem 0.6rem; */
        font-size: 0.8rem;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
        color: #aaa;
        /* margin-right: 5px; */
        font-size: 0.8rem;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
        color: #fff;
    }

    .select2-search__field {
        font-family: inherit !important;
    }

    .select2-dropdown {
        background-color: #f6f3f1;
        border-color: #e0e0e0;
    }

    .select2-container--default .select2-results__option--highlighted,
    .select2-container--default .select2-results__option--selected {
        background-color: #333 !important;
        color: #fff !important;
    }

    /* ... (existing select2 styles) ... */
    .article-choice-area {
        margin-bottom: 1.5rem;
    }

    .radio-options label {
        margin-right: 1.5rem;
    }

    #user-article-wrapper {
        display: none;
    }
    /* Hidden by default */
</style>
{% endblock %}

{% block content %}
<main class="main-content" style="flex: 1; border-right: none;">
    <div class="upload-container">
        <h2 class="upload-title">Upload Paper</h2>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-field">
                <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
                {{ form.title }}
            </div>

            <div class="form-field">
                <label for="{{ form.pdf_file.id_for_label }}">File Upload</label>
                {{ form.pdf_file }}
            </div>

            <div class="form-field">
                <label for="{{ form.publication_year.id_for_label }}">{{ form.publication_year.label }}</label>
                {{ form.publication_year }}
            </div>

            <!-- NEW: Article choice section -->
            <div class="form-field article-choice-area">
                <label>{{ form.article_choice.label }}</label>
                <div class="radio-options">{{ form.article_choice }}</div>
            </div>
            <div class="form-field" id="user-article-wrapper">
                <label for="{{ form.user_article.id_for_label }}">{{ form.user_article.label }}</label>
                {{ form.user_article }}
            </div>
            <!-- End of new section -->

            <hr style="margin: 2rem 0;">

            <div class="form-field">
                <label for="{{ form.author_users.id_for_label }}">{{ form.author_users.label }}</label>
                {{ form.author_users }}
            </div>

            <div class="form-field">
                <label for="{{ form.new_authors.id_for_label }}">{{ form.new_authors.label }}</label>
                {{ form.new_authors }}
            </div>

            <div class="upload-actions">
                <button type="submit" class="upload-btn">Upload</button>
            </div>
        </form>
    </div>
</main>
{% endblock %}


{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize the searchable author select
            $('.author-select-input').select2({
                placeholder: "Search and select users...",
                width: '100%'
            });

            // --- NEW: JavaScript to toggle the article text area ---
            const articleChoiceRadios = document.querySelectorAll('input[name="article_choice"]');
            const userArticleWrapper = document.getElementById('user-article-wrapper');
            
            articleChoiceRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'manual') {
                        userArticleWrapper.style.display = 'block';
                    } else {
                        userArticleWrapper.style.display = 'none';
                    }
                });
            });
        });
    </script>
{% endblock %}